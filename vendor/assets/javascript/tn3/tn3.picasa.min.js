/*!
 * tn3 picasa plugin v1.4.0.97
 * http://tn3gallery.com/
 *
 * License
 * http://tn3gallery.com/license
 *
 * Date: 01 Apr, 2013 21:48:35 +0300
 */
(function(f){var h=f.fn.tn3.External;h.picasa=function(a,d){this.config=f.extend(true,{},h.picasa.config,a);this.extcon=d;if(a.noInit)d.reqs--;else this.init()};h.picasa.config={userID:"default",source:"albums",albumID:"",params:{"start-index":1,"max-results":20,thumbsize:"72c",imgmax:"1024"},aparams:{thumbsize:"72c"},albumInfo:{}};h.picasa.prototype={config:null,extcon:null,init:function(){this.getAlbums()},getAlbums:function(){if(this.config.source=="albums"){var a={};a=f.extend(a,this.config.aparams);
a.kind="album";this.request(a,"user/"+this.config.userID)}else{a={title:this.config.source,adata:{origin:"picasa"}};f.extend(a,this.config.albumInfo);this.extcon.setAlbumData([a])}},getImages:function(a,d){var b={},e;b=f.extend(b,this.config.params);b.kind="photo";switch(this.config.source){case "albums":e="user/"+this.config.userID+"/albumid/"+a.id;break;case "photos":e="user/"+this.config.userID;break;case "album":e="user/"+this.config.userID+"/albumid/"+this.config.albumID;break;case "featured":e=
"featured";break;case "all":e="all";break;default:return}this.request(b,e,a,d)},request:function(a,d,b,e){a.alt="json-in-script";f.ajax({url:"http://picasaweb.google.com/data/feed/api/"+d,type:"GET",dataType:"jsonp",cache:false,context:this,jsonp:"callback",success:function(c){a.kind=="album"?this.parseAlbums(c.feed.entry):this.parsePhotos(c.feed.entry,e)},data:a})},parsePhotos:function(a,d){var b=[],e=this,c;f.each(a,function(i,g){c={raw:g};f.extend(c,{title:g.media$group.media$title.$t,description:g.media$group.media$description.$t,
thumb:g.media$group.media$thumbnail[0].url,img:g.media$group.media$content[0].url});if(g.gphoto$videostatus&&g.gphoto$videostatus.$t=="final")c.content=e.getVideoContent(g,c.img);b.push(c)});this.extcon.setImageData(b,d)},getVideoContent:function(a,d){var b=a.media$group.media$content[2];return'<video width="'+b.width+'" height="'+b.height+'" poster="'+d+'" type="video/mp4" src="'+b.url+'" controls="controls" preload="none"></video>'},parseAlbums:function(a){var d=[],b;f.each(a,function(e,c){if(c.gphoto$numphotos.$t!=
0){b={raw:c};f.extend(b,{title:c.title.$t,description:c.summary.$t,thumb:c.media$group.media$thumbnail[0].url,adata:{id:c.gphoto$id.$t,origin:"picasa"}});d.push(b)}});this.extcon.setAlbumData(d)}}})(jQuery);
